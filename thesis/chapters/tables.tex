%======================================================================
% ToolShield — Final Tables and Figures
% Generated from data/reports/latex_tables.txt (standard dataset)
% and data/reports/experiments_longschema/latex_tables.txt (long-schema)
%======================================================================

%----------------------------------------------------------------------
% Table 1: Main Results (Standard Dataset)
%----------------------------------------------------------------------
\begin{table}[htbp]
\centering
\caption{Model performance across split protocols on the standard dataset. Higher ROC-AUC and lower FPR@TPR are better.}
\label{tab:main-results}
\begin{tabular}{llcccc}
\toprule
Protocol & Model & ROC-AUC & PR-AUC & FPR@TPR90 & FPR@TPR95 \\
\midrule
S\_attack\_holdout & context\_transformer\_keep\_prompt & 0.999 & 0.999 & 0.000 & 0.010 \\
S\_attack\_holdout & context\_transformer\_naive & 0.998 & 0.999 & 0.000 & 0.010 \\
\midrule
S\_random & context\_transformer & 1.000 & 1.000 & 0.000 & 0.000 \\
S\_random & context\_transformer\_keep\_prompt & 1.000 & 1.000 & 0.000 & 0.000 \\
S\_random & context\_transformer\_naive & 1.000 & 1.000 & 0.000 & 0.000 \\
S\_random & heuristic & 0.714 & 0.872 & 1.000 & 1.000 \\
S\_random & heuristic\_score & 0.714 & 0.872 & 1.000 & 1.000 \\
S\_random & tfidf\_lr & 1.000 & 1.000 & 0.000 & 0.000 \\
S\_random & transformer & 0.988 & 0.991 & 0.020 & 0.200 \\
\bottomrule
\end{tabular}
\end{table}

%----------------------------------------------------------------------
% Table 2: ASR Reduction (Standard Dataset)
%----------------------------------------------------------------------
\begin{table}[htbp]
\centering
\caption{ASR reduction at different TPR operating points on the standard dataset. Higher is better.}
\label{tab:asr-results}
\begin{tabular}{llcc}
\toprule
Protocol & Model & ASR Red.@TPR90 & ASR Red.@TPR95 \\
\midrule
S\_attack\_holdout & context\_transformer\_keep\_prompt & 93.6\% & 97.6\% \\
S\_attack\_holdout & context\_transformer\_naive & 91.2\% & 97.6\% \\
\midrule
S\_random & context\_transformer & 90.3\% & 100.0\% \\
S\_random & context\_transformer\_keep\_prompt & 92.7\% & 100.0\% \\
S\_random & context\_transformer\_naive & 94.4\% & 96.0\% \\
S\_random & heuristic & 100.0\% & 100.0\% \\
S\_random & heuristic\_score & 100.0\% & 100.0\% \\
S\_random & tfidf\_lr & 90.3\% & 96.8\% \\
S\_random & transformer & 94.4\% & 100.0\% \\
\bottomrule
\end{tabular}
\end{table}

%----------------------------------------------------------------------
% Table 3: Budget-Based Evaluation (Standard Dataset)
%----------------------------------------------------------------------
\begin{table}[htbp]
\centering
\caption{Performance at FPR budgets (1\%, 3\%, 5\%) on the standard dataset. Threshold selected on validation set.}
\label{tab:budget-results}
\begin{tabular}{llccc}
\toprule
Protocol & Model & TPR@1\% & TPR@3\% & TPR@5\% \\
\midrule
S\_attack\_holdout & context\_transformer\_keep\_prompt & 0.0\% & 0.0\% & 0.0\% \\
S\_attack\_holdout & context\_transformer\_naive & 0.0\% & 0.0\% & 0.0\% \\
\midrule
S\_random & context\_transformer & nan\% & nan\% & nan\% \\
S\_random & context\_transformer\_keep\_prompt & 0.0\% & 0.0\% & 0.0\% \\
S\_random & context\_transformer\_naive & 0.0\% & 0.0\% & 0.0\% \\
S\_random & heuristic & nan\% & nan\% & nan\% \\
S\_random & heuristic\_score & nan\% & nan\% & nan\% \\
S\_random & tfidf\_lr & nan\% & nan\% & nan\% \\
S\_random & transformer & nan\% & nan\% & nan\% \\
\bottomrule
\end{tabular}
\end{table}

%----------------------------------------------------------------------
% Table 4: Inference Latency (Standard Dataset)
%----------------------------------------------------------------------
\begin{table}[htbp]
\centering
\caption{Inference latency per batch (100 samples) on the standard dataset. Lower is better.}
\label{tab:latency-results}
\begin{tabular}{lcc}
\toprule
Model & P50 (ms) & P95 (ms) \\
\midrule
context\_transformer\_keep\_prompt & 4378.38 & 4912.70 \\
context\_transformer\_naive & 2861.11 & 3092.64 \\
context\_transformer & 11525.83 & 12220.22 \\
heuristic & 1.48 & 1.71 \\
heuristic\_score & 1.58 & 1.65 \\
tfidf\_lr & 2.63 & 2.89 \\
transformer & 11614.90 & 12622.74 \\
\bottomrule
\end{tabular}
\end{table}

%----------------------------------------------------------------------
% Table 5: Truncation Strategy Ablation (Standard Dataset)
%----------------------------------------------------------------------
\begin{table}[htbp]
\centering
\caption{Truncation strategy ablation on the standard dataset. TPR and ASR at fixed FPR budgets (1\%, 3\%, 5\%), plus warm inference latency. Mean$\pm$std over seeds.}
\label{tab:truncation-ablation}
\resizebox{\textwidth}{!}{%
\begin{tabular}{ll ccc ccc cc}
\toprule
 & & \multicolumn{3}{c}{TPR (\%)} & \multicolumn{3}{c}{ASR (\%)} & \multicolumn{2}{c}{Latency (ms)} \\
\cmidrule(lr){3-5} \cmidrule(lr){6-8} \cmidrule(lr){9-10}
Protocol & Strategy & @1\% & @3\% & @5\% & @1\% & @3\% & @5\% & P50 & P95 \\
\midrule
S\_attack\_holdout & keep\_prompt & 0.0\% & 0.0\% & 0.0\% & 0.0\% & 0.0\% & 0.0\% & 4378.38 & 4912.70 \\
S\_attack\_holdout & naive & 0.0\% & 0.0\% & 0.0\% & 0.0\% & 0.0\% & 0.0\% & 2861.11 & 3092.64 \\
\midrule
S\_random & keep\_prompt & 0.0\% & 0.0\% & 0.0\% & 0.0\% & 0.0\% & 0.0\% & 4669.87 & 4995.15 \\
S\_random & naive & 0.0\% & 0.0\% & 0.0\% & 0.0\% & 0.0\% & 0.0\% & 2744.15 & 3030.53 \\
\bottomrule
\end{tabular}}
\end{table}

%----------------------------------------------------------------------
% Table 6: Enterprise Long-Schema Stress Test
%----------------------------------------------------------------------
\begin{table}[htbp]
\centering
\caption{Enterprise truncation stress test (4\,000-char schemas). Prompt truncation and model performance under naive vs \texttt{keep\_prompt} strategies.}
\label{tab:longschema-stress}
\resizebox{\textwidth}{!}{%
\begin{tabular}{ll cc cccc cc}
\toprule
 & & \multicolumn{2}{c}{Truncation} & \multicolumn{4}{c}{Performance} & \multicolumn{2}{c}{Latency (ms)} \\
\cmidrule(lr){3-4} \cmidrule(lr){5-8} \cmidrule(lr){9-10}
Protocol & Strategy & Trunc.\% & Ret. Mean & ROC-AUC & PR-AUC & FPR@90 & FPR@95 & P50 & P95 \\
\midrule
S\_attack\_holdout & keep\_prompt & 0.0\% & 1.000 & 0.998 & 0.998 & 0.000 & 0.010 & 4577.99 & 4776.15 \\
S\_attack\_holdout & naive & 100.0\% & 0.000 & 0.455 & 0.541 & 0.920 & 0.950 & 4225.00 & 4623.28 \\
\midrule
S\_random & keep\_prompt & 0.0\% & 1.000 & 0.997 & 0.998 & 0.000 & 0.003$\pm$0.006 & 4485.98 & 5004.86 \\
S\_random & naive & 100.0\% & 0.000 & 0.479 & 0.657 & 0.900 & 0.960 & 4485.99 & 4755.51 \\
\bottomrule
\end{tabular}}
\end{table}

%----------------------------------------------------------------------
% Figure 1: Prompt Retention — Quartile Plot
%----------------------------------------------------------------------
\begin{figure}[htbp]
\centering
\includegraphics[width=\textwidth]{figures/prompt_retention_quartiles.png}
\caption{Prompt retention ratio by schema token length quartiles under enterprise-length schemas. Naive truncation collapses retention to zero across all bins, while \texttt{keep\_prompt} preserves the full prompt.}
\label{fig:prompt-retention-quartiles}
\end{figure}

%----------------------------------------------------------------------
% Figure 2: Prompt Retention — Decile Plot
%----------------------------------------------------------------------
\begin{figure}[htbp]
\centering
\includegraphics[width=\textwidth]{figures/prompt_retention_deciles.png}
\caption{Prompt retention ratio by schema token length deciles under enterprise-length schemas. Fine-grained view confirming that retention collapse under naive truncation is uniform across all schema length bins.}
\label{fig:prompt-retention-deciles}
\end{figure}
