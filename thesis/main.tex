%% ToolShield Bachelor Thesis — TU Darmstadt Corporate Design
%% Based on DEMO-TUDaThesis.tex (tuda-ci v4.05, 2025-11-13)

% ── PDF/A-2b compliance (must precede \documentclass) ────────────────────────
\DocumentMetadata{
  pdfstandard=a-2b,
  pdfversion=1.7,
  lang=en,
}

\documentclass[
  english,
  accentcolor=9c,
  ruledheaders=section,
  class=report,
  thesis={type=bachelor},
  fontsize=11pt,
  parskip=half-,
  custommargins=true,
  marginpar=false,
  accept-missing-logos=true,
]{tudapub}

% ── Packages ─────────────────────────────────────────────────────────────────
\usepackage[english]{babel}
\usepackage{microtype}
\usepackage[autostyle]{csquotes}
\usepackage{amsmath,amssymb}
\usepackage{graphicx}
\graphicspath{{figures/}}
\usepackage{booktabs}
\usepackage{verbatim}

% ── Bibliography (biblatex, as required by TUDa-CI) ─────────────────────────
\usepackage{biblatex}
\addbibresource{references.bib}

% ── PDF metadata ─────────────────────────────────────────────────────────────
\hypersetup{
  pdfauthor={Giselle Evita},
  pdfkeywords={prompt injection, LLM, tool-use, truncation, security, TU Darmstadt},
}

% ── Thesis metadata ──────────────────────────────────────────────────────────
\title{ToolShield: Prompt Injection Detection for Tool-Using LLM Agents}
\author{Giselle Evita}
\reviewer{[Supervisor Name TBD] \and [Second Reviewer TBD]}
\department{inf}
\institute{Department of Computer Science}
%\group{[Research Group TBD]}  % only used for doctoral theses
\submissiondate{\today}
\examdate{\today}

% ── Document ─────────────────────────────────────────────────────────────────
\begin{document}

\maketitle

% ── Declaration (Eigenständigkeitserklärung) ─────────────────────────────────
% According to TU Darmstadt APB §22(7), a signed declaration must be included.
% The affidavit was deactivated by default in tuda-ci v4. The official legally
% binding text should be downloaded from:
%   https://www.tu-darmstadt.de/studieren/studierende_tu/studienorganisation_und_tucan/hilfe_und_faq/artikel_details_de_en_37824.de.jsp
% Print the .docx, sign it, scan it, and include the signed PDF page here:
%
% \usepackage{pdfpages}
% \includepdf[pages=-]{signed_declaration.pdf}
%
% For now, a placeholder declaration is included:
\newpage
\thispagestyle{empty}
\vspace*{3cm}
\begin{center}
\textbf{\Large Erklärung zur Abschlussarbeit\\gemäß §22 Abs.\ 7 APB der TU Darmstadt}
\end{center}
\vspace{1.5cm}
\noindent
Hiermit versichere ich, Giselle Evita, die vorliegende Bachelor-Thesis ohne Hilfe Dritter und nur mit den angegebenen Quellen und Hilfsmitteln angefertigt zu haben. Alle Stellen, die Quellen entnommen wurden, sind als solche kenntlich gemacht worden. Diese Arbeit hat in gleicher oder ähnlicher Form noch keiner Prüfungsbehörde vorgelegen.

\noindent
Mir ist bekannt, dass im Fall eines Plagiats (§38 Abs.\ 2 APB) ein Täuschungsversuch vorliegt, der dazu führen kann, dass die Prüfung als ablegt und nicht bestanden betrachtet und die Vergabe des Hochschulgrades entzogen wird.

\vspace{2cm}
\noindent
Darmstadt, \today \hfill \makebox[6cm]{\dotfill}\\
\mbox{} \hfill {\small Giselle Evita}

% ── Abstract ─────────────────────────────────────────────────────────────────
\newpage
\begin{abstract}
This thesis addresses the problem of detecting prompt injection attacks in tool-using LLM systems, where user-provided prompts are combined with privileged tool context and forwarded to a language model for tool invocation. A prompt injection detection pipeline called ToolShield is presented, evaluating multiple baseline models (heuristics, TF-IDF, transformer classifiers) and context-augmented transformer detectors across controlled split protocols. The central finding is that naive right-truncation of context-augmented inputs can silently remove the user prompt under enterprise-length tool schemas, causing detection performance to collapse to near-random levels. A prompt-preserving truncation strategy is proposed that reserves a minimum token budget for the user prompt, maintaining robust detection even when tool schemas exceed the model's context window. All experiments are reproducible via deterministic seeds, automated verification scripts, and a public artifact bundle.
\end{abstract}

\tableofcontents

% ── Chapters ─────────────────────────────────────────────────────────────────
\input{chapters/introduction}
\input{chapters/related_work}
\input{chapters/methodology}
\input{chapters/implementation}
\input{chapters/results}
\input{chapters/discussion}
\input{chapters/threats_to_validity}
\input{chapters/conclusion}

% ── Appendix ─────────────────────────────────────────────────────────────────
\appendix

\chapter{Experimental Tables and Figures}
\label{sec:tables_and_figures}
\input{chapters/tables}

\chapter{Reproducibility Notes}
\label{sec:reproducibility_notes}

All experimental results reported in this thesis can be reproduced from the
repository using two commands:

\begin{verbatim}
make compare_truncation_longschema
make verify_longschema_results
\end{verbatim}

The first command executes the full long-schema truncation ablation pipeline
(dataset generation, splitting, training, evaluation, and aggregation). The
second command runs the automated verification script, which checks artifact
completeness, truncation invariant consistency, and ROC-AUC regression bounds.

\paragraph{Artifact index.}
The file \texttt{THESIS\_ARTIFACTS.md} in the repository root serves as the
authoritative index linking each thesis table and figure to the exact data
file from which it was derived.

\paragraph{Supporting artifacts.}
The following files document the experimental environment and execution:

\begin{itemize}
    \item \texttt{run\_manifest.md} --- records the git commit hash, executed
          commands, dataset configuration, and model settings for each
          experiment run.
    \item \texttt{environment\_freeze.txt} --- captures the exact Python
          package versions (torch, transformers, scikit-learn, etc.) used
          during training and evaluation.
    \item \texttt{verification\_output.txt} --- contains the full output of
          the automated verification pipeline, confirming that all artifact
          checks passed.
\end{itemize}

Together with deterministic seeds and controlled split protocols, these
artifacts ensure that reported results are traceable to a specific repository
state and reproducible under equivalent conditions.

% ── Bibliography ─────────────────────────────────────────────────────────────
\printbibliography

\end{document}
